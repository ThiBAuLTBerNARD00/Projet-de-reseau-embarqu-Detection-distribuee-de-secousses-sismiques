/*
 * Methodes.h
 *
 *  Created on: Dec 26, 2025
 *      Author: thiba
 */

#ifndef INC_METHODES_H_
#define INC_METHODES_H_
#include "stm32f7xx_hal.h"
#include "cmsis_os.h"
#include "lwip/udp.h"
#include "lwip/ip_addr.h"
#include <stdbool.h>
#include <stdint.h>
#include <stdarg.h>
#include <stdio.h>
#include <stdarg.h>

/* DÃ©pendances projet */
extern UART_HandleTypeDef huart3;
extern ADC_HandleTypeDef hadc1;
extern SPI_HandleTypeDef hspi2;
extern TIM_HandleTypeDef htim2;
extern I2C_HandleTypeDef hi2c1;
extern RTC_HandleTypeDef hrtc;
extern struct netif gnetif;
/* =======================
 * Fonctions publiques
 * ======================= */
static struct udp_pcb *ntp_pcb;
static bool is_synced =false;
/* Log via queue */
void log_message(const char *format, ...);

/* NTP / RTC */
void ntp_receive(void *arg,
                 struct udp_pcb *pcb,
                 struct pbuf *p,
                 const ip_addr_t *addr,
                 u16_t port);

void sync_rtc_with_ntp(void);

/* Traitement signal */
float movingAverage(float previous, float newSample);
float computeRMS(float *buffer, uint16_t len);

/* Broadcast */
void store_broadcast_ip(const ip_addr_t *addr);

/* FRAM */
void FRAM_Write(uint16_t addr, uint8_t *data, uint8_t length);
uint8_t FRAM_Read(uint16_t addr, uint8_t *buffer, uint8_t length);

/* RTC externe BQ32000 */
HAL_StatusTypeDef RTC_ReadTime(RTC_extern *rtc);
HAL_StatusTypeDef RTC_SetTime(RTC_extern rtc);
void rtc_get_timestamp(char *buffer, RTC_extern *rtc);


#endif /* INC_METHODES_H_ */
